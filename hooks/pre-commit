#!/bin/sh

echo "Running pre-commit hooks..."

# Run mise fix-all task (cargo fmt + cargo clippy --fix --allow-dirty)
echo "Running formatting and clippy fixes..."
mise run fix-all
if [ $? -ne 0 ]; then
    echo "❌ Code formatting and clippy fixes failed."
    exit 1
fi

echo "Running mise run newlines-fix..."
mise run newlines-fix
if [ $? -ne 0 ]; then
    echo "newlines fix failed"
    exit 1
fi

# Re-add any files that were modified by the fixes
echo "Re-adding modified files to commit..."
git add -A

echo "✅ All checks passed and fixes applied!"
exit 0
